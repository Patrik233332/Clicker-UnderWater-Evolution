<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Clicker Game</title>
    <style>
        body { margin: 0; padding: 0; background: #000; }
        #unity-container { position: absolute; width: 100%; height: 100%; }
        #loading { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: white; font-family: Arial, sans-serif; }
        #unity-canvas { width: 100%; height: 100%; display: block; }
    </style>
</head>
<body>
    <div id="unity-container">
        <div id="loading">Initializing...</div>
        <canvas id="unity-canvas" width="960" height="600"></canvas>
    </div>

    <script>
        var container = document.querySelector("#unity-container");
        var canvas = document.querySelector("#unity-canvas");
        var loading = document.querySelector("#loading");
        
        // Пути к .br файлам
        var config = {
            dataUrl: "Build/webgl-build.data.br",
            frameworkUrl: "Build/webgl-build.framework.js.br",
            codeUrl: "Build/webgl-build.wasm.br",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "DefaultCompany",
            productName: "Clicker",
            productVersion: "1.0"
        };
        
        // Проверяем поддержку Brotli
        function supportsBrotli() {
            try {
                return 'br' in new CompressionStream('deflate');
            } catch (e) {
                return false;
            }
        }
        
        // Если Brotli не поддерживается, пробуем обычные файлы
        if (!supportsBrotli()) {
            console.warn("Brotli not supported, trying uncompressed files");
            config.dataUrl = "Build/webgl-build.data";
            config.frameworkUrl = "Build/webgl-build.framework.js";
            config.codeUrl = "Build/webgl-build.wasm";
        }

        // Загружаем лоадер
        var script = document.createElement("script");
        script.src = "Build/webgl-build.loader.js"; // loader обычно без .br
        
        script.onload = function() {
            loading.textContent = "Loading 0%";
            
            createUnityInstance(canvas, config, function(progress) {
                var percent = Math.round(progress * 100);
                loading.textContent = "Loading " + percent + "%";
            }).then(function(instance) {
                console.log("Unity loaded successfully");
                loading.style.display = "none";
                canvas.style.display = "block";
            }).catch(function(error) {
                console.error("Unity error:", error);
                
                // Fallback: пробуем обычные файлы если .br не работает
                if (config.dataUrl.includes('.br')) {
                    loading.textContent = "Retrying with uncompressed files...";
                    
                    config.dataUrl = "Build/webgl-build.data";
                    config.frameworkUrl = "Build/webgl-build.framework.js";
                    config.codeUrl = "Build/webgl-build.wasm";
                    
                    createUnityInstance(canvas, config, function(progress) {
                        var percent = Math.round(progress * 100);
                        loading.textContent = "Loading " + percent + "%";
                    }).then(function() {
                        loading.style.display = "none";
                    }).catch(function(fallbackError) {
                        loading.textContent = "Failed to load. Check browser console.";
                        console.error("Fallback also failed:", fallbackError);
                    });
                } else {
                    loading.textContent = "Failed to load. Check browser console.";
                }
            });
        };

        script.onerror = function() {
            loading.textContent = "Failed to load game script. Check if files exist.";
            console.error("Failed to load loader.js");
        };

        document.body.appendChild(script);
    </script>
</body>
</html>